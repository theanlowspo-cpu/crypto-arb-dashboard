<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âš–ï¸ Delta Neutral å¥—åˆ©</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0a0a; color: #e0e0e0; font-family: -apple-system, 'Segoe UI', sans-serif; padding: 12px; max-width: 600px; margin: 0 auto; }
.header { text-align: center; padding: 16px 0; }
.header h1 { font-size: 1.4em; color: #00d4aa; }
.header .subtitle { font-size: 0.8em; color: #888; margin-top: 4px; }
.status-bar { display: flex; justify-content: space-between; align-items: center; background: #141414; border-radius: 10px; padding: 10px 14px; margin: 10px 0; border: 1px solid #222; }
.status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 6px; }
.status-dot.open { background: #00d4aa; box-shadow: 0 0 8px #00d4aa; }
.status-dot.waiting { background: #f0a030; box-shadow: 0 0 8px #f0a030; }
.status-text { font-size: 0.9em; }
.update-time { font-size: 0.75em; color: #666; }
.cards { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 10px 0; }
.card { background: #141414; border-radius: 10px; padding: 12px; border: 1px solid #222; text-align: center; }
.card .label { font-size: 0.7em; color: #888; margin-bottom: 4px; }
.card .value { font-size: 1.2em; font-weight: 700; }
.card .sub { font-size: 0.7em; color: #666; margin-top: 2px; }
.positive { color: #00d4aa; }
.negative { color: #ff4466; }
.neutral { color: #f0a030; }
.section { background: #141414; border-radius: 10px; padding: 14px; margin: 10px 0; border: 1px solid #222; }
.section h3 { font-size: 0.85em; color: #00d4aa; margin-bottom: 10px; }
.row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #1a1a1a; font-size: 0.82em; }
.row:last-child { border-bottom: none; }
.row .k { color: #888; }
.row .v { font-weight: 600; }
.rate-bar { display: flex; align-items: center; gap: 4px; margin: 3px 0; }
.rate-bar .bar { height: 14px; border-radius: 3px; min-width: 2px; }
.rate-bar .bar.pos { background: #00d4aa; }
.rate-bar .bar.neg { background: #ff4466; }
.rate-bar .lbl { font-size: 0.65em; color: #888; min-width: 35px; }
.rate-bar .val { font-size: 0.7em; min-width: 50px; text-align: right; }
.countdown { font-size: 1.1em; text-align: center; color: #f0a030; font-weight: 700; padding: 8px; }
.footer { text-align: center; font-size: 0.65em; color: #444; padding: 16px 0; }
</style>
</head>
<body>

<div class="header">
  <h1>âš–ï¸ Delta Neutral å¥—åˆ©</h1>
  <div class="subtitle">ç¾è²¨è²·å…¥ + åˆç´„åšç©º = ç´”åƒæ­£è²»ç‡</div>
</div>

<div class="status-bar">
  <div>
    <span class="status-dot waiting" id="statusDot"></span>
    <span class="status-text" id="statusText">è¼‰å…¥ä¸­...</span>
  </div>
  <div class="update-time" id="updateTime">--</div>
</div>

<div class="countdown" id="countdown">â±ï¸ ä¸‹æ¬¡çµç®—: è¨ˆç®—ä¸­...</div>

<div class="cards">
  <div class="card">
    <div class="label">BTC åƒ¹æ ¼</div>
    <div class="value" id="btcPrice">--</div>
  </div>
  <div class="card">
    <div class="label">ç•¶å‰è²»ç‡</div>
    <div class="value" id="currentRate">--</div>
    <div class="sub" id="annualRate">å¹´åŒ– --%</div>
  </div>
  <div class="card">
    <div class="label">æ·¨æ›éšª</div>
    <div class="value" id="netExposure">$0</div>
    <div class="sub">è¶Šæ¥è¿‘ $0 è¶Šå¥½</div>
  </div>
  <div class="card">
    <div class="label">è²»ç‡æ”¶ç›Š</div>
    <div class="value positive" id="fundingEarned">$0.00</div>
    <div class="sub" id="fundingCount">0 æ¬¡çµç®—</div>
  </div>
</div>

<div class="section">
  <h3>ğŸ“Š æŒå€‰æ˜ç´°</h3>
  <div class="row"><span class="k">ç¾è²¨ BTC</span><span class="v" id="spotQty">--</span></div>
  <div class="row"><span class="k">ç¾è²¨åƒ¹å€¼</span><span class="v" id="spotValue">--</span></div>
  <div class="row"><span class="k">åˆç´„ç©ºå–®</span><span class="v" id="futuresQty">--</span></div>
  <div class="row"><span class="k">åˆç´„å…¥å ´åƒ¹</span><span class="v" id="futuresEntry">--</span></div>
  <div class="row"><span class="k">åˆç´„æœªå¯¦ç¾ç›ˆè™§</span><span class="v" id="futuresPnl">--</span></div>
</div>

<div class="section">
  <h3>ğŸ’° å¸³æˆ¶</h3>
  <div class="row"><span class="k">åˆç´„é¤˜é¡</span><span class="v" id="futBal">--</span></div>
  <div class="row"><span class="k">ç¾è²¨ USDT</span><span class="v" id="spotUsdt">--</span></div>
  <div class="row"><span class="k">æ­£è²»ç‡æ¯”ä¾‹ (è¿‘20æ¬¡)</span><span class="v" id="posRatio">--</span></div>
  <div class="row"><span class="k">å¹³å‡è²»ç‡ (è¿‘20æ¬¡)</span><span class="v" id="avgRate">--</span></div>
</div>

<div class="section">
  <h3>ğŸ“ˆ è¿‘æœŸè²»ç‡</h3>
  <div id="rateChart"></div>
</div>

<div class="footer">
  Delta Neutral Bot v1.0 | æ•¸æ“šæ¯ 5 åˆ†é˜æ›´æ–°<br>
  âš ï¸ åƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆæŠ•è³‡å»ºè­°
</div>

<script>
const DATA_URL = 'data.json?t=' + Date.now();

async function load() {
  try {
    const res = await fetch(DATA_URL);
    const d = await res.json();
    render(d);
  } catch(e) {
    document.getElementById('statusText').textContent = 'âŒ è¼‰å…¥å¤±æ•—';
  }
}

function render(d) {
  // Status
  const dot = document.getElementById('statusDot');
  const stxt = document.getElementById('statusText');
  if (d.status === 'open') {
    dot.className = 'status-dot open';
    stxt.textContent = d.statusText;
  } else {
    dot.className = 'status-dot waiting';
    stxt.textContent = d.statusText;
  }

  // Update time
  const ut = new Date(d.lastUpdate);
  document.getElementById('updateTime').textContent = ut.toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' });

  // BTC price
  document.getElementById('btcPrice').textContent = '$' + Number(d.btcPrice).toLocaleString('en', { maximumFractionDigits: 0 });

  // Rate
  const rate = d.rates.btc.rate;
  const rateEl = document.getElementById('currentRate');
  rateEl.textContent = (rate * 100).toFixed(4) + '%';
  rateEl.className = 'value ' + (rate >= 0 ? 'positive' : 'negative');
  document.getElementById('annualRate').textContent = 'å¹´åŒ– ' + d.rates.btc.annualized;

  // Countdown
  const now = Date.now();
  const next = d.rates.nextFunding;
  function updateCountdown() {
    const diff = next - Date.now();
    if (diff <= 0) { document.getElementById('countdown').textContent = 'â±ï¸ çµç®—ä¸­...'; return; }
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    document.getElementById('countdown').textContent = `â±ï¸ ä¸‹æ¬¡çµç®—: ${h}h ${m}m ${s}s`;
  }
  updateCountdown();
  setInterval(updateCountdown, 1000);

  // Net exposure
  const ne = document.getElementById('netExposure');
  ne.textContent = '$' + d.position.netExposure;
  ne.className = 'value ' + (Math.abs(parseFloat(d.position.netExposure)) < 5 ? 'positive' : 'neutral');

  // Funding earned
  document.getElementById('fundingEarned').textContent = '$' + (parseFloat(d.position.futuresPnl) || 0).toFixed(4);
  document.getElementById('fundingCount').textContent = (d.rateHistory || []).length + ' æ¬¡è²»ç‡ç´€éŒ„';

  // Position
  document.getElementById('spotQty').textContent = d.position.spotBtc + ' BTC';
  document.getElementById('spotValue').textContent = '$' + d.position.spotValue;
  document.getElementById('futuresQty').textContent = d.position.futuresQty + ' BTC';
  document.getElementById('futuresEntry').textContent = '$' + Number(d.position.futuresEntry).toLocaleString('en', { maximumFractionDigits: 2 });
  const pnlEl = document.getElementById('futuresPnl');
  const pnl = parseFloat(d.position.futuresPnl);
  pnlEl.textContent = '$' + d.position.futuresPnl;
  pnlEl.className = 'v ' + (pnl >= 0 ? 'positive' : 'negative');

  // Account
  document.getElementById('futBal').textContent = '$' + d.account.futuresBalance;
  document.getElementById('spotUsdt').textContent = '$' + d.account.spotUsdt;
  document.getElementById('posRatio').textContent = d.rates.positiveRatio;
  document.getElementById('avgRate').textContent = d.rates.avgRate20;

  // Rate chart
  const chart = document.getElementById('rateChart');
  const rates = d.rateHistory || [];
  const maxAbs = Math.max(...rates.map(r => Math.abs(r.rate)), 0.0001);
  chart.innerHTML = rates.slice(-15).map(r => {
    const pct = Math.abs(r.rate) / maxAbs * 100;
    const cls = r.rate >= 0 ? 'pos' : 'neg';
    const time = new Date(r.time).toLocaleString('zh-TW', { timeZone: 'Asia/Taipei', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    const color = r.rate >= 0 ? '#00d4aa' : '#ff4466';
    return `<div class="rate-bar">
      <span class="lbl">${time}</span>
      <div class="bar ${cls}" style="width:${Math.max(pct, 3)}%"></div>
      <span class="val" style="color:${color}">${(r.rate * 100).toFixed(4)}%</span>
    </div>`;
  }).join('');
}

load();
setInterval(load, 300000);
</script>
</body>
</html>
