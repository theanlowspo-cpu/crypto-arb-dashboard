<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŸ é–‹å¿ƒå¥—åˆ©å°å»šæˆ¿</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #FFF3CD 0%, #FFECB3 50%, #FFE082 100%);
  min-height: 100vh;
  color: #333;
}
.header {
  background: linear-gradient(90deg, #DA291C, #FF5722, #DA291C);
  color: white;
  padding: 20px;
  text-align: center;
  box-shadow: 0 4px 15px rgba(218,41,28,0.3);
  position: relative;
  overflow: hidden;
}
.header h1 { font-size: 2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
.header .subtitle { font-size: 1.1em; opacity: 0.9; margin-top: 5px; }
.header .mascot {
  position: absolute; right: 20px; top: 50%; transform: translateY(-50%);
  width: 80px; height: 80px; border-radius: 50%; border: 3px solid #FFC107;
  object-fit: cover;
}
.header .mascot-left {
  position: absolute; left: 20px; top: 50%; transform: translateY(-50%);
  width: 80px; height: 80px; border-radius: 50%; border: 3px solid #FFC107;
  object-fit: cover;
}
.status-bar {
  background: #FFC107;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
  color: #333;
  flex-wrap: wrap;
  gap: 10px;
}
.status-item { display: flex; align-items: center; gap: 5px; }
.status-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
.dot-green { background: #4CAF50; box-shadow: 0 0 8px #4CAF50; }
.dot-red { background: #f44336; box-shadow: 0 0 8px #f44336; }
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }
.summary-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}
.card {
  background: white;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
  text-align: center;
  border-top: 4px solid #FFC107;
  transition: transform 0.2s;
}
.card:hover { transform: translateY(-3px); }
.card .emoji { font-size: 2em; }
.card .label { color: #888; font-size: 0.85em; margin-top: 5px; }
.card .value { font-size: 1.8em; font-weight: bold; margin-top: 5px; }
.card .sub { font-size: 0.75em; color: #999; margin-top: 3px; }
.card .value.profit { color: #4CAF50; }
.card .value.loss { color: #f44336; }
.card .value.neutral { color: #FF9800; }
.section-title {
  font-size: 1.4em;
  color: #DA291C;
  margin: 25px 0 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}
</style>
</head>
<body>

<div class="header">
  <img src="img/burger_thief1.jpg" class="mascot-left" alt="æ¼¢å ¡ç¥å·">
  <h1>ğŸŸ é–‹å¿ƒå¥—åˆ©å°å»šæˆ¿ ğŸ”</h1>
  <div class="subtitle">âš–ï¸ Delta Neutral æ­£è²»ç‡å¥—åˆ© â€” ç©©ç©©åƒè²»ç‡ ğŸ’°</div>
  <img src="img/fries1.jpg" class="mascot" alt="è–¯æ¢å¯¶å¯¶">
</div>

<div class="status-bar">
  <div class="status-item">
    <span class="status-dot dot-green" id="statusDot"></span>
    <span id="statusText">è¼‰å…¥ä¸­...</span>
  </div>
  <div class="status-item">ğŸ• æ›´æ–°: <span id="lastUpdate">è¼‰å…¥ä¸­...</span></div>
  <div class="status-item">â±ï¸ ä¸‹æ¬¡çµç®—: <span id="nextSettlement">è¨ˆç®—ä¸­...</span></div>
</div>

<div class="container">
  <div class="summary-cards">
    <div class="card">
      <div class="emoji">â‚¿</div>
      <div class="label">BTC åƒ¹æ ¼</div>
      <div class="value" id="btcPrice">--</div>
    </div>
    <div class="card">
      <div class="emoji">ğŸ“Š</div>
      <div class="label">ç•¶å‰è²»ç‡</div>
      <div class="value" id="currentRate">--</div>
      <div class="sub" id="annualRate">å¹´åŒ– --%</div>
    </div>
    <div class="card">
      <div class="emoji">âš–ï¸</div>
      <div class="label">æ·¨æ›éšª</div>
      <div class="value" id="netExposure">$0</div>
      <div class="sub">è¶Šæ¥è¿‘ $0 è¶Šå¥½</div>
    </div>
    <div class="card">
      <div class="emoji">ğŸ’°</div>
      <div class="label">åˆç´„ç›ˆè™§</div>
      <div class="value" id="futuresPnl">$0.00</div>
    </div>
    <div class="card">
      <div class="emoji">ğŸ†</div>
      <div class="label">æ­£è²»ç‡æ¯”ä¾‹</div>
      <div class="value" id="posRatio">--</div>
      <div class="sub">è¿‘ 20 æ¬¡çµç®—</div>
    </div>
    <div class="card">
      <div class="emoji">ğŸ“ˆ</div>
      <div class="label">å¹³å‡è²»ç‡</div>
      <div class="value" id="avgRate">--</div>
      <div class="sub">è¿‘ 20 æ¬¡çµç®—</div>
    </div>
  </div>

  <div class="section-title">ğŸŸ æŒå€‰æ˜ç´°</div>
  <div class="positions-grid" id="positionsGrid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:15px;margin-bottom:20px;">
    <div style="background:white;border-radius:16px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,0.08);border-left:5px solid #FFC107;">
      <p style="text-align:center;color:#888;">è¼‰å…¥ä¸­...</p>
    </div>
  </div>

  <div class="section-title">ğŸ’° å¸³æˆ¶ç¸½è¦½</div>
  <div style="background:white;border-radius:16px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,0.08);margin-bottom:20px;" id="accountSection">
    <p style="text-align:center;color:#888;">è¼‰å…¥ä¸­...</p>
  </div>

  <div class="cute-section" style="text-align:center;padding:20px;">
    <img src="img/hamster1.jpg" class="floating" alt="å€‰é¼ å¯¶å¯¶" title="å€‰é¼ å¯¶å¯¶" style="width:120px;height:120px;border-radius:50%;border:4px solid #FFC107;margin:0 10px;box-shadow:0 4px 15px rgba(255,193,7,0.3);">
    <img src="img/milkshake1.jpg" class="floating" style="animation-delay:0.5s;width:120px;height:120px;border-radius:50%;border:4px solid #FFC107;margin:0 10px;box-shadow:0 4px 15px rgba(255,193,7,0.3);" alt="å¥¶æ˜”å¤§å“¥" title="å¥¶æ˜”å¤§å“¥">
    <img src="img/burger_thief2.jpg" class="floating" style="animation-delay:1s;width:120px;height:120px;border-radius:50%;border:4px solid #FFC107;margin:0 10px;box-shadow:0 4px 15px rgba(255,193,7,0.3);" alt="æ¼¢å ¡ç¥å·" title="æ¼¢å ¡ç¥å·">
    <img src="img/rocket_cat1.jpg" class="floating" style="animation-delay:1.5s;width:120px;height:120px;border-radius:50%;border:4px solid #FFC107;margin:0 10px;box-shadow:0 4px 15px rgba(255,193,7,0.3);" alt="ç«ç®­è²“" title="ç«ç®­è²“">
    <img src="img/fries2.jpg" class="floating" style="animation-delay:2s;width:120px;height:120px;border-radius:50%;border:4px solid #FFC107;margin:0 10px;box-shadow:0 4px 15px rgba(255,193,7,0.3);" alt="è–¯æ¢å¯¶å¯¶" title="è–¯æ¢å¯¶å¯¶">
  </div>

  <div class="section-title">ğŸ“ˆ è¿‘æœŸè²»ç‡èµ°å‹¢</div>
  <div style="background:white;border-radius:16px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,0.08);margin-bottom:20px;" id="rateChart">
    <p style="text-align:center;color:#888;">è¼‰å…¥ä¸­...</p>
  </div>

  <div class="footer" style="text-align:center;padding:20px;">
    <div style="text-align:center;padding:10px">
      <img src="img/milkshake2.jpg" class="floating" style="width:80px;height:80px;border-radius:50%;border:4px solid #FFC107;margin:0 10px;animation-delay:0.3s" alt="å¥¶æ˜”">
      <img src="img/hamster2.jpg" class="floating" style="width:80px;height:80px;border-radius:50%;border:4px solid #FFC107;margin:0 10px;animation-delay:0.8s" alt="å€‰é¼ ">
      <img src="img/rocket_cat2.jpg" class="floating" style="width:80px;height:80px;border-radius:50%;border:4px solid #FFC107;margin:0 10px;animation-delay:1.3s" alt="ç«ç®­è²“">
    </div>
    <p style="color:#888;font-size:0.85em;">ğŸ” ç”¨æ„›èˆ‡æ¼”ç®—æ³•è£½ä½œ <span style="color:#DA291C">â¤ï¸</span> çµ¦æœ€å¯æ„›çš„å¯¶è² ğŸŸ</p>
    <p style="margin-top:5px;color:#888;font-size:0.85em;">Delta Neutral Bot v1.0 | è‡ªå‹•æ›´æ–°æ¯ 5 åˆ†é˜ | è³‡æ–™åƒ…ä¾›åƒè€ƒ</p>
    <p style="margin-top:5px;font-size:0.75em;color:#888;">ğŸŸ Ba da ba ba ba~ I'm lovin' it ğŸ’•</p>
  </div>
</div>

<style>
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}
.floating { animation: float 3s ease-in-out infinite; }
@media (max-width: 600px) {
  .header h1 { font-size: 1.4em; }
  .header .mascot, .header .mascot-left { display: none; }
  .summary-cards { grid-template-columns: repeat(2, 1fr); }
  .card .value { font-size: 1.4em; }
}
.detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; font-size: 0.9em; }
.detail-row:last-child { border-bottom: none; }
.detail-row .dk { color: #888; }
.detail-row .dv { font-weight: bold; }
.rate-item { display: flex; align-items: center; gap: 8px; padding: 4px 0; }
.rate-item .rbar { height: 16px; border-radius: 4px; min-width: 3px; }
.rate-item .rbar.rpos { background: linear-gradient(90deg, #4CAF50, #8BC34A); }
.rate-item .rbar.rneg { background: linear-gradient(90deg, #f44336, #FF5722); }
.rate-item .rlbl { font-size: 0.75em; color: #888; min-width: 80px; }
.rate-item .rval { font-size: 0.8em; font-weight: bold; min-width: 60px; text-align: right; }
</style>

<script>
const DATA_URL = 'data.json';

function formatTime(ts) {
  if (!ts) return '--';
  return new Date(ts).toLocaleString('zh-TW', { timeZone: 'Asia/Taipei', hour12: false });
}

function shortTime(ts) {
  if (!ts) return '--';
  return new Date(ts).toLocaleString('zh-TW', { timeZone: 'Asia/Taipei', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false });
}

let countdownInterval;

async function loadData() {
  try {
    const res = await fetch(DATA_URL + '?t=' + Date.now());
    const d = await res.json();
    render(d);
  } catch(e) {
    document.getElementById('statusText').textContent = 'âŒ è¼‰å…¥å¤±æ•—';
  }
}

function render(d) {
  // Status
  const age = Date.now() - new Date(d.lastUpdate).getTime();
  const online = age < 10 * 60 * 1000;
  document.getElementById('statusDot').className = 'status-dot ' + (online ? 'dot-green' : 'dot-red');
  
  if (d.status === 'open') {
    document.getElementById('statusText').textContent = 'ğŸŸ¢ æŒå€‰ä¸­ â€” ç©©ç©©åƒè²»ç‡ ğŸŸ';
  } else {
    document.getElementById('statusText').textContent = 'â³ ç­‰å¾…æ­£è²»ç‡ä¸­...';
  }

  document.getElementById('lastUpdate').textContent = formatTime(d.lastUpdate);

  // Countdown
  if (countdownInterval) clearInterval(countdownInterval);
  const next = d.rates.nextFunding;
  function updateCD() {
    const diff = next - Date.now();
    if (diff <= 0) { document.getElementById('nextSettlement').textContent = 'çµç®—ä¸­...'; return; }
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    document.getElementById('nextSettlement').textContent = `${h}h ${m}m ${s}s`;
  }
  updateCD();
  countdownInterval = setInterval(updateCD, 1000);

  // Cards
  document.getElementById('btcPrice').textContent = '$' + Number(d.btcPrice).toLocaleString('en', { maximumFractionDigits: 0 });

  const rate = d.rates.btc.rate;
  const rateEl = document.getElementById('currentRate');
  rateEl.textContent = (rate * 100).toFixed(4) + '%';
  rateEl.className = 'value ' + (rate >= 0 ? 'profit' : 'loss');
  document.getElementById('annualRate').textContent = 'å¹´åŒ– ' + d.rates.btc.annualized;

  const ne = parseFloat(d.position.netExposure);
  const neEl = document.getElementById('netExposure');
  neEl.textContent = '$' + Math.abs(ne).toFixed(2);
  neEl.className = 'value ' + (Math.abs(ne) < 10 ? 'profit' : 'neutral');

  const pnl = parseFloat(d.position.futuresPnl);
  const pnlEl = document.getElementById('futuresPnl');
  pnlEl.textContent = (pnl >= 0 ? '+' : '') + '$' + pnl.toFixed(4);
  pnlEl.className = 'value ' + (pnl >= 0 ? 'profit' : 'loss');

  document.getElementById('posRatio').textContent = d.rates.positiveRatio;
  document.getElementById('avgRate').textContent = d.rates.avgRate20;

  // Position detail
  const grid = document.getElementById('positionsGrid');
  if (d.status === 'open') {
    grid.innerHTML = `
      <div style="background:white;border-radius:16px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,0.08);border-left:5px solid #4CAF50;">
        <div style="font-size:1.3em;font-weight:bold;color:#DA291C;">ğŸŸ¢ BTCUSDT Delta Neutral</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;font-size:0.9em;">
          <span class="dk" style="color:#888">ç¾è²¨æŒæœ‰</span><span class="dv" style="font-weight:bold;text-align:right">${d.position.spotBtc} BTC</span>
          <span class="dk" style="color:#888">ç¾è²¨åƒ¹å€¼</span><span class="dv" style="font-weight:bold;text-align:right">$${d.position.spotValue}</span>
          <span class="dk" style="color:#888">åˆç´„ç©ºå–®</span><span class="dv" style="font-weight:bold;text-align:right">${d.position.futuresQty} BTC</span>
          <span class="dk" style="color:#888">åˆç´„å…¥å ´åƒ¹</span><span class="dv" style="font-weight:bold;text-align:right">$${Number(d.position.futuresEntry).toLocaleString('en', {maximumFractionDigits:2})}</span>
          <span class="dk" style="color:#888">æœªå¯¦ç¾ç›ˆè™§</span><span class="dv" style="font-weight:bold;text-align:right;color:${pnl>=0?'#4CAF50':'#f44336'}">${pnl>=0?'+':''}$${pnl.toFixed(4)}</span>
          <span class="dk" style="color:#888">æ·¨æ›éšª</span><span class="dv" style="font-weight:bold;text-align:right;color:${Math.abs(ne)<10?'#4CAF50':'#FF9800'}">$${Math.abs(ne).toFixed(2)}</span>
        </div>
      </div>`;
  } else {
    grid.innerHTML = '<div style="background:white;border-radius:16px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,0.08);border-left:5px solid #FFC107;"><p style="text-align:center;color:#888;">ğŸŸ ç­‰å¾…æ­£è²»ç‡ï¼Œæº–å‚™é–‹å€‰ä¸­...</p></div>';
  }

  // Account
  const acct = document.getElementById('accountSection');
  acct.innerHTML = `
    <div class="detail-row"><span class="dk">åˆç´„é¤˜é¡</span><span class="dv">$${d.account.futuresBalance}</span></div>
    <div class="detail-row"><span class="dk">åˆç´„å¯ç”¨</span><span class="dv">$${d.account.futuresAvailable}</span></div>
    <div class="detail-row"><span class="dk">ç¾è²¨ USDT</span><span class="dv">$${d.account.spotUsdt}</span></div>
    <div class="detail-row"><span class="dk">ç¾è²¨ BTC åƒ¹å€¼</span><span class="dv">$${d.account.spotBtcValue}</span></div>
    <div class="detail-row"><span class="dk">ETH è²»ç‡</span><span class="dv" style="color:${d.rates.eth.rate>=0?'#4CAF50':'#f44336'}">${(d.rates.eth.rate*100).toFixed(4)}% (å¹´åŒ– ${d.rates.eth.annualized})</span></div>
  `;

  // Rate chart
  const chart = document.getElementById('rateChart');
  const rates = d.rateHistory || [];
  const maxAbs = Math.max(...rates.map(r => Math.abs(r.rate)), 0.0001);
  chart.innerHTML = rates.slice(-15).map(r => {
    const pct = Math.abs(r.rate) / maxAbs * 100;
    const cls = r.rate >= 0 ? 'rpos' : 'rneg';
    const color = r.rate >= 0 ? '#4CAF50' : '#f44336';
    return `<div class="rate-item">
      <span class="rlbl">${shortTime(r.time)}</span>
      <div class="rbar ${cls}" style="width:${Math.max(pct, 3)}%"></div>
      <span class="rval" style="color:${color}">${(r.rate * 100).toFixed(4)}%</span>
    </div>`;
  }).join('');
}

loadData();
setInterval(loadData, 60000);
</script>
</body>
</html>
